services:

  wdio-cucumber:
    build: .
    image: wdio-cucumber
    container_name: webdriver-cuke
    depends_on:
      - selenium-hub
      - chrome
      - firefox
    environment:
      TEST_ENVIRONMENT_ROOT_URL: ${TEST_ENVIRONMENT_ROOT_URL}
      TEST_TAGS: ${TEST_TAGS}
      CHROME_ARGS: "--headless --ignore-certificate-errors"
      HOST_NAME: "selenium-hub"
  
  # selenium:
  #   image: selenium/standalone-chrome-debug
  #   container_name: chrome-browser

  chrome:
    image: selenium/node-chrome
    tty: false
    stdin_open: false
    shm_size: 2gb
    depends_on:
      - selenium-hub
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443
      - SE_NODE_MAX_SESSIONS=2

  firefox:
    image: selenium/node-firefox #:4.1.3-20220405
    tty: false
    stdin_open: false
    shm_size: 2gb
    depends_on:
      - selenium-hub
    environment:
      - SE_EVENT_BUS_HOST=selenium-hub
      - SE_EVENT_BUS_PUBLISH_PORT=4442
      - SE_EVENT_BUS_SUBSCRIBE_PORT=4443

  selenium-hub:
    image: selenium/hub
    container_name: selenium-hub

# Make sure to run using below command `docker-compose up --exit-code-from wdio-cucumber`
      # `--exit-code-from wdio-cucumber` command will exit all service if wdio-cucumber exits

# docker-compose run --rm wdio-cucumber



